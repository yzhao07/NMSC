---
title: "Species_level_remove_ambiguous"
author: "Yujie Zhao"
date: "2023-12-14"
output: html_document
---

```{r}
rm(list=ls())
library("stringr")
species_all = read.csv("../analysis/A01.1-add-meta/jhmi-sears-non-melanoma.species-otu.avgGTE0.01Prct.txt",sep="\t")
rownames(species_all) = species_all$SampleID
species=species_all[,11:ncol(species_all)]

species_a = species[,startsWith(colnames(species), "otu")]
species_b = species[,!startsWith(colnames(species), "otu")]

species_ambi = species_b[,str_count(colnames(species_b),"\\.") >=1]
species_b = species_b[,str_count(colnames(species_b),"\\.") <1]

species_ambi = as.data.frame(cbind(species_ambi,species_a[,str_count(colnames(species_a),"\\.") >=2,]))
species_a = species_a[,str_count(colnames(species_a),"\\.") <2,]
species_remove = data.frame(cbind(species_a,species_b))
species_remove = as.data.frame(t(species_remove))
species_remove$species = gsub(".*\\.","",rownames(species_remove))
species_remove = aggregate(. ~ species, data=species_remove, FUN=sum)
rownames(species_remove) = species_remove$species
species_remove =species_remove[,2:ncol(species_remove)]
species_remove = as.data.frame(cbind(species_all[,1:10],t(species_remove),species_ambi))

write.table(species_remove,file="../analysis/A01.1-add-meta/jhmi-sears-non-melanoma.species.txt",sep="\t",row.names=FALSE,quote = FALSE)

```

